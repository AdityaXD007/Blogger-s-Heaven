{% extends 'home/base.html' %} {% load static %} {% block content %}
<div class="container">
  <h1 class="page-title">Create New Post</h1>

  <div id="successMessage" class="success-message" style="display: none">
    Post created successfully!
  </div>

  <form
    id="postForm"
    method="post"
    action="{% url 'write' %}"
    enctype="multipart/form-data"
  >
    {% csrf_token %}

    <div class="form-group">
      <label for="postTitle">Post Title</label>
      <input
        type="text"
        id="postTitle"
        name="title"
        required
        placeholder="Enter your post title..."
      />
    </div>

    <div class="form-group">
      <label for="postAuthor">Author</label>
      <input
        type="text"
        id="postAuthor"
        name="author"
        required
        placeholder="Your name..."
      />
    </div>

    <div class="form-group">
      <label for="postCategory">Category</label>
      <select id="postCategory" name="category" required>
        <option value="">Select a category</option>
        <option value="Technology">Technology</option>
        <option value="Business">Business</option>
        <option value="Lifestyle">Lifestyle</option>
        <option value="Travel">Travel</option>
        <option value="Food">Food</option>
        <option value="Health">Health</option>
        <option value="Education">Education</option>
        <option value="Entertainment">Entertainment</option>
      </select>
    </div>

    <div class="form-group">
      <label for="postImage">Image</label>
      <input type="file" id="postImage" name="image" accept="image/*" />
    </div>

    <div class="form-group">
      <label for="postContent">Content</label>
      <textarea
        id="postContent"
        name="content"
        required
        placeholder="Write your post content here..."
      ></textarea>
    </div>

    <button type="submit" class="btn">Publish Post</button>
  </form>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("postForm");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(form);

      fetch('{% url "write" %}', {
        method: "POST",
        body: formData,
        headers: {
          "X-Requested-With": "XMLHttpRequest",
        },
      })
        .then((response) => response.text())
        .then((text) => {
          try {
            const data = JSON.parse(text);
            if (data.success) {
              document.getElementById("successMessage").style.display = "block";
              form.reset();
            } else {
              alert("Error: " + (data.message || "Unknown server error"));
            }
          } catch (e) {
            console.error("JSON parse error", e);
            alert("Unexpected server response.");
          }
        })
        .catch((error) => {
          console.error("Network error:", error);
          alert("Network error occurred.");
        });
    });
  });
</script>
{% endblock %}
